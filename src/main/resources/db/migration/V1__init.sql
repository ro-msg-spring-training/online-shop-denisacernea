create table if not exists address (id integer generated by default as identity, city varchar(255) not null, country varchar(255) not null, county varchar(255), street varchar(255) not null, primary key (id));
create table if not exists  customer (id integer generated by default as identity, firstname varchar(255), lastname varchar(255), username varchar(255), password varchar(255), email varchar(255), primary key (id));
create table if not exists  location (id integer generated by default as identity, name varchar(255) not null, addressid integer not null, primary key (id));
create table if not exists  orderdetail (id integer generated by default as identity, quantity integer not null, orderid integer not null, productid integer not null, primary key (id));
create table if not exists  orders (id integer generated by default as identity, createtime timestamp, addressid integer not null, customerid integer not null, locationid integer not null, primary key (id));
create table if not exists  product (id integer generated by default as identity, description varchar(255), name varchar(255) not null, price decimal(19,2) not null, weight double, productcategoryid integer not null, supplierid integer not null, primary key (id));
create table if not exists  productcategory (id integer generated by default as identity, description varchar(255), name varchar(255) not null, primary key (id));
create table if not exists  stock (id integer generated by default as identity, quantity integer not null, locationid integer not null, productid integer not null, primary key (id));
create table if not exists  supplier (id integer generated by default as identity, name varchar(255) not null, primary key (id));
alter table location add constraint UK_location_name unique (name);
alter table orderdetail add constraint UK_orderid_productid unique (orderid, productid);
alter table productcategory add constraint UK_productcategory_name unique (name);
alter table stock add constraint UK_productid_locationid unique (productid, locationid);
alter table supplier add constraint UK_supplier_name unique (name);
alter table location add constraint FK_location_address foreign key (addressid) references address;
alter table orderdetail add constraint FK_orderdetail_order foreign key (orderid) references orders;
alter table orderdetail add constraint FK_orderdetail_product foreign key (productid) references product;
alter table orders add constraint FK_orders_address foreign key (addressid) references address;
alter table orders add constraint FK_orders_customer foreign key (customerid) references customer;
alter table orders add constraint FK_orders_location foreign key (locationid) references location;
alter table product add constraint FK_product_productcategory foreign key (productcategoryid) references productcategory;
alter table product add constraint FK_product_supplier foreign key (supplierid) references supplier;
alter table stock add constraint FK_stock_location foreign key (locationid) references location;
alter table stock add constraint FK_stock_product foreign key (productid) references product;
create table if not exists revenue (id integer generated by default as identity, locationid integer not null, salesdate date, salessum decimal(19,2) not null);
alter table revenue add constraint FK_revenue_location foreign key (locationid) references location;
alter table revenue add constraint FK_locationid_salesdate unique (locationid, salesdate);